(()=>{var e={};e.id=828,e.ids=[828],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2518:e=>{"use strict";e.exports=require("mongodb")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3834:(e,t,r)=>{"use strict";let s;r.d(t,{$V:()=>c,Ay:()=>p});var n=r(6037),a=r.n(n),o=r(2518);let d=process.env.MONGODB_URI||"mongodb+srv://tmuneebanjum:A5Y1enJBJcDVwPrt@jorn.nx9fd28.mongodb.net/smartsave",i="trading-journal";if(!d)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let l=global.mongoose;async function u(){if(l.conn)return l.conn;l.promise||(l.promise=a().connect(d,{bufferCommands:!1}).then(e=>e));try{l.conn=await l.promise}catch(e){throw l.promise=null,e}return l.conn}async function c(){try{let e=await s;console.log("Connected to MongoDB successfully, using database:",i);let t=e.db(i);return{client:e,db:t}}catch(e){throw console.error("Failed to connect to database:",e),e}}l||(l=global.mongoose={conn:null,promise:null}),s=new o.MongoClient(d).connect();let p=u},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6037:e=>{"use strict";e.exports=require("mongoose")},6487:()=>{},6509:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>u,POST:()=>c,PUT:()=>p});var n=r(6559),a=r(8088),o=r(7719),d=r(3834),i=r(2190),l=r(2518);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId"),s=t.get("accountId");if(!r)return i.NextResponse.json({error:"User ID is required"},{status:400});let{db:n}=await (0,d.$V)(),a={userId:r};s&&(a.accountId=s);let o=await n.collection("am_trades").find(a).sort({createdAt:-1}).toArray();return i.NextResponse.json({trades:o})}catch(e){return console.error("Error fetching AM trades:",e),i.NextResponse.json({error:"Failed to fetch AM trades"},{status:500})}}async function c(e){try{let{userId:t,accountId:r,dateTime:s,manualDateTime:n,weekday:a,month:o,quarter:l,accountSize:u,direction:c,tradingPair:p,strategy:g,entryPrice:m,takeProfit:f,stopLoss:x,setup:w,htfFramework:y,dailyProfile:j,entryCandle:A,entryTime:R,entryTimeFrame:M,entryConfluence:h,duration:I,riskPercent:T,plannedRR:v,analysis:N,notes:P,riskManagementLessons:D,tags:b,screenshot:E,calculatedResults:q}=await e.json();if(!t||!r||!p||!m||!f||!x)return i.NextResponse.json({error:"Required fields missing"},{status:400});let{db:F}=await (0,d.$V)(),O={userId:t,accountId:r,dateTime:s||new Date().toISOString(),manualDateTime:n||!1,weekday:a||"",month:o||"",quarter:l||"",accountSize:parseFloat(u)||0,direction:c||"",tradingPair:p||"",strategy:g||"",entryPrice:parseFloat(m),takeProfit:parseFloat(f),stopLoss:parseFloat(x),setup:w||"",htfFramework:y||"",dailyProfile:j||"",entryCandle:A||"",entryTime:R||"",entryTimeFrame:M||"",entryConfluence:h||"",duration:I||"",riskPercent:T||"2",plannedRR:v||"",analysis:N||"",notes:P||"",riskManagementLessons:D||"",tags:b||"",screenshot:E||null,calculatedResults:q||{},status:null,actualEntry:null,actualExit:null,actualProfit:null,exitReason:null,exitNotes:"",createdAt:new Date,updatedAt:new Date},_=await F.collection("am_trades").insertOne(O);return i.NextResponse.json({success:!0,tradeId:_.insertedId,message:"AM Trade created successfully"})}catch(e){return console.error("Error creating AM trade:",e),i.NextResponse.json({error:"Failed to create AM trade"},{status:500})}}async function p(e){try{let{tradeId:t,userId:r,_id:s,createdAt:n,...a}=await e.json();if(!t||!r)return i.NextResponse.json({error:"Trade ID and User ID are required"},{status:400});let{_id:o,userId:u,createdAt:c,...p}=a,{db:g}=await (0,d.$V)(),m=await g.collection("am_trades").updateOne({_id:new l.ObjectId(t),userId:r},{$set:{...p,updatedAt:new Date}});if(0===m.matchedCount)return i.NextResponse.json({error:"AM Trade not found"},{status:404});return i.NextResponse.json({success:!0,message:"AM Trade updated successfully"})}catch(e){return console.error("Error updating AM trade:",e),i.NextResponse.json({error:"Failed to update AM trade"},{status:500})}}async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("tradeId")||t.get("id"),s=t.get("userId");if(console.log("AM Trade DELETE request:",{tradeId:r,userId:s}),!r)return console.error("Missing tradeId in delete request"),i.NextResponse.json({error:"Trade ID is required"},{status:400});if(!l.ObjectId.isValid(r))return console.error("Invalid tradeId format:",r),i.NextResponse.json({error:"Invalid Trade ID format"},{status:400});let{db:n}=await (0,d.$V)(),a={_id:new l.ObjectId(r)};s&&(a.userId=s),console.log("Delete filter:",a);let o=await n.collection("am_trades").findOne(a);if(!o)return console.error("AM Trade not found:",a),i.NextResponse.json({error:"AM Trade not found or access denied"},{status:404});console.log("Found trade to delete:",{_id:o._id,tradingPair:o.tradingPair});let u=await n.collection("am_trades").deleteOne(a);if(console.log("Delete result:",u),0===u.deletedCount)return console.error("No trades were deleted"),i.NextResponse.json({error:"Failed to delete AM Trade"},{status:500});return console.log("AM Trade deleted successfully"),i.NextResponse.json({success:!0,message:"AM Trade deleted successfully",deletedTrade:{_id:o._id,tradingPair:o.tradingPair}})}catch(e){return console.error("Error deleting AM trade:",e),i.NextResponse.json({error:"Failed to delete AM trade",details:e.message},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/am-trades/route",pathname:"/api/am-trades",filename:"route",bundlePath:"app/api/am-trades/route"},resolvedPagePath:"E:\\trading-journal-app\\app\\api\\am-trades\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:x,serverHooks:w}=m;function y(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:x})}},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(6509));module.exports=s})();