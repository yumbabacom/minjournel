(()=>{var e={};e.id=758,e.ids=[758],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2478:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>w,serverHooks:()=>v,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>m});var o=r(6559),a=r(8088),n=r(7719),i=r(2190),u=r(3205),l=r.n(u),c=r(3834),p=r(7652);let d=process.env.JWT_SECRET||"your-secret-key-change-in-production";async function m(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return i.NextResponse.json({error:"Please provide email and password"},{status:400});await (0,c.Ay)();let s=await p.A.findOne({email:t.toLowerCase()}).select("+password");if(!s)return i.NextResponse.json({error:"Invalid email or password"},{status:401});if(!s.isActive)return i.NextResponse.json({error:"Account is deactivated. Please contact support."},{status:401});if(!await s.comparePassword(r))return i.NextResponse.json({error:"Invalid email or password"},{status:401});s.lastLogin=new Date,await s.save(),console.log("Creating token with userId:",s._id);let o=l().sign({userId:s._id.toString(),email:s.email,fullName:s.fullName},d,{expiresIn:"7d"}),a=i.NextResponse.json({message:"Login successful",user:s.toPublicJSON(),token:o},{status:200});return a.cookies.set("auth-token",o,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:6048e5}),a}catch(e){return console.error("Login error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let w=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"E:\\trading-journal-app\\app\\api\\auth\\login\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:h,serverHooks:v}=w;function f(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:h})}},2518:e=>{"use strict";e.exports=require("mongodb")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3834:(e,t,r)=>{"use strict";let s;r.d(t,{$V:()=>p,Ay:()=>d});var o=r(6037),a=r.n(o),n=r(2518);let i=process.env.MONGODB_URI||"mongodb+srv://tmuneebanjum:A5Y1enJBJcDVwPrt@jorn.nx9fd28.mongodb.net/smartsave",u="trading-journal";if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let l=global.mongoose;async function c(){if(l.conn)return l.conn;l.promise||(l.promise=a().connect(i,{bufferCommands:!1}).then(e=>e));try{l.conn=await l.promise}catch(e){throw l.promise=null,e}return l.conn}async function p(){try{let e=await s;console.log("Connected to MongoDB successfully, using database:",u);let t=e.db(u);return{client:e,db:t}}catch(e){throw console.error("Failed to connect to database:",e),e}}l||(l=global.mongoose={conn:null,promise:null}),s=new n.MongoClient(i).connect();let d=c},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},6037:e=>{"use strict";e.exports=require("mongoose")},6487:()=>{},7652:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(6037),o=r.n(s),a=r(5663);let n=new(o()).Schema({fullName:{type:String,required:[!0,"Please provide a full name"],maxlength:[60,"Name cannot be more than 60 characters"]},email:{type:String,required:[!0,"Please provide an email"],unique:!0,lowercase:!0,match:[/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,"Please provide a valid email"]},password:{type:String,required:[!0,"Please provide a password"],minlength:[6,"Password must be at least 6 characters"],select:!1},createdAt:{type:Date,default:Date.now},lastLogin:{type:Date},isActive:{type:Boolean,default:!0}});n.pre("save",async function(e){if(!this.isModified("password"))return e();try{let t=await a.Ay.hash(this.password,12);this.password=t,e()}catch(t){e(t)}}),n.methods.comparePassword=async function(e){return await a.Ay.compare(e,this.password)},n.methods.toPublicJSON=function(){let e=this.toObject();return delete e.password,e};let i=o().models.User||o().model("User",n)},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,205,663],()=>r(2478));module.exports=s})();