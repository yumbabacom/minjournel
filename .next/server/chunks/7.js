exports.id=7,exports.ids=[7],exports.modules={771:(e,t,r)=>{"use strict";let a=r(758),o=r(9021),n=r(3873);class i{constructor(){this.browser=null,this.csvFilePath=n.join(process.cwd(),"data","economic_calendar.csv"),this.dataDir=n.join(process.cwd(),"data")}getCurrentGMT4Time(){return new Date(new Date().getTime()+-144e5)}ensureDataDirectory(){o.existsSync(this.dataDir)||o.mkdirSync(this.dataDir,{recursive:!0})}async initialize(){this.browser||(this.browser=await a.launch({headless:!0,defaultViewport:null,args:["--no-sandbox","--disable-setuid-sandbox","--disable-web-security","--disable-dev-shm-usage","--disable-gpu","--no-first-run"]}))}async scrapeEconomicCalendar(){console.log("Starting economic calendar scraper..."),await this.initialize();try{let e=await this.browser.newPage();await e.setUserAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"),console.log("Navigating to investing.com economic calendar..."),await e.goto("https://www.investing.com/economic-calendar/",{waitUntil:"domcontentloaded",timeout:6e4}),await new Promise(e=>setTimeout(e,8e3)),console.log("Extracting economic calendar data...");let t=await e.evaluate(()=>{let e=[];for(let t of["#economicCalendarData tr",".ec-table-row","tr[event_attr_id]","table tr",".calendar-row"])try{let r=document.querySelectorAll(t);if(console.log(`Trying selector: ${t}, found ${r.length} rows`),r.length>0&&(r.forEach((t,r)=>{try{if(t.querySelector("th"))return;let r=t.querySelectorAll("td");if(r.length<4)return;let a=r[0]?r[0].textContent.trim():"",o=r[1]?r[1].textContent.trim():"",n=function(e){let t=0;[".grayFullBullishIcon",".orangeFullBullishIcon",".redFullBullishIcon",".impact",".bull",'[class*="bull"]','[class*="impact"]'].forEach(r=>{let a=e.querySelectorAll(r);a.length>t&&(t=a.length)});let r=e.querySelector("td:nth-child(3), .impact, [data-impact]");if(r){let e=r.textContent.trim().toLowerCase();e.includes("high")||e.includes("3")?t=3:e.includes("medium")||e.includes("2")?t=2:(e.includes("low")||e.includes("1"))&&(t=1)}return t}(t),i="";for(let e=2;e<r.length;e++){let t=r[e].textContent.trim();if(t.length>10&&!t.match(/^[\d\.\-\+%]+$/)){i=t;break}}let l=[];for(let e=3;e<Math.min(r.length,7);e++)l.push(r[e]?r[e].textContent.trim():"");i&&i.length>0&&e.push({time:a,currency:o,impact:n,event:i,actual:l[0]||"",forecast:l[1]||"",previous:l[2]||""})}catch(e){console.log(`Error processing row ${r}:`,e.message)}}),e.length>0)){console.log(`Successfully extracted ${e.length} events`);break}}catch(e){console.log(`Selector ${t} failed:`,e.message)}return e});if(await e.close(),console.log(`Extracted ${t.length} economic events`),t.length>0)return t.map((e,t)=>({id:t+1,time:e.time,currency:e.currency,event:e.event,description:this.generateDescription(e.event),importance:this.mapImpactLevel(e.impact),forecast:e.forecast||null,previous:e.previous||null,actual:e.actual||null}));return console.log("No data found"),[]}catch(e){throw console.error("Error during scraping:",e),e}}mapImpactLevel(e){return e>=3?"high":e>=2?"medium":"low"}generateDescription(e){for(let[t,r]of Object.entries({CPI:"Consumer Price Index measures inflation",GDP:"Gross Domestic Product measures economic growth",NFP:"Non-Farm Payrolls measures employment change","Interest Rate":"Central bank interest rate decision",PMI:"Purchasing Managers Index measures economic activity",Unemployment:"Unemployment rate measures job market health","Retail Sales":"Retail sales measures consumer spending","Industrial Production":"Industrial production measures manufacturing output"}))if(e.toLowerCase().includes(t.toLowerCase()))return r;return`Economic indicator: ${e}`}saveToCSV(e){try{this.ensureDataDirectory();let t=e.map(e=>{let t=new Date().toISOString();return[e.id,`"${e.time}"`,`"${e.currency}"`,`"${e.event.replace(/"/g,'""')}"`,`"${e.description.replace(/"/g,'""')}"`,`"${e.importance}"`,`"${e.forecast||""}"`,`"${e.previous||""}"`,`"${e.actual||""}"`,`"${t}"`].join(",")}).join("\n");return o.writeFileSync(this.csvFilePath,"ID,Time,Currency,Event,Description,Importance,Forecast,Previous,Actual,Timestamp\n"+t,"utf8"),console.log(`‚úÖ Economic calendar data saved to ${this.csvFilePath}`),!0}catch(e){return console.error("‚ùå Error saving to CSV:",e),!1}}loadFromCSV(){try{if(!o.existsSync(this.csvFilePath))return console.log("\uD83D\uDCC4 No CSV file found, will need to scrape fresh data"),null;let e=o.readFileSync(this.csvFilePath,"utf8").split("\n");if(e.length<2)return console.log("\uD83D\uDCC4 CSV file is empty or invalid"),null;let t=[];for(let r=1;r<e.length;r++){let a=e[r].trim();if(a)try{let e=this.parseCSVLine(a);e.length>=9&&t.push({id:parseInt(e[0])||t.length+1,time:e[1],currency:e[2],event:e[3],description:e[4],importance:e[5],forecast:e[6]||null,previous:e[7]||null,actual:e[8]||null})}catch(e){console.log(`‚ö†Ô∏è Error parsing CSV line ${r}: ${e.message}`)}}if(t.length>0)return console.log(`‚úÖ Loaded ${t.length} events from CSV file`),t;return console.log("\uD83D\uDCC4 No valid data found in CSV file"),null}catch(e){return console.error("‚ùå Error loading from CSV:",e),null}}parseCSVLine(e){let t=[],r="",a=!1,o=0;for(;o<e.length;){let n=e[o];'"'===n?a&&'"'===e[o+1]?(r+='"',o+=2):(a=!a,o++):(","!==n||a?r+=n:(t.push(r),r=""),o++)}return t.push(r),t}isCSVDataFromToday(){try{if(!o.existsSync(this.csvFilePath))return console.log("\uD83D\uDCC4 No CSV file exists"),!1;let e=o.statSync(this.csvFilePath),t=new Date(e.mtime),r=new Date,a=new Date(r.getTime()+-144e5),n=new Date(t.getTime()+-144e5),i=a.toDateString(),l=n.toDateString(),s=i===l;return console.log(`üìÖ Current GMT-4 day: ${i}`),console.log(`üìÖ CSV file day: ${l}`),console.log(`üìÖ Is same day: ${s}`),s}catch(e){return console.error("‚ùå Error checking CSV date:",e),!1}}shouldRunDailyScraper(){try{if(new Date().getTime(),!this.isCSVDataFromToday())return console.log("\uD83D\uDD50 No data from today (GMT-4), should scrape"),!0;return console.log("‚úÖ Already have data from today (GMT-4), no need to scrape"),!1}catch(e){return console.error("‚ùå Error checking if should run daily scraper:",e),!1}}async getEconomicCalendarData(e=!1){try{if(console.log("\uD83D\uDD0D Checking economic calendar data availability..."),e){console.log("\uD83D\uDD04 Force refresh requested, scraping new data...");let e=await this.scrapeEconomicCalendar();if(e&&e.length>0)return this.saveToCSV(e),{data:e,source:"scraped_force",timestamp:new Date().toISOString()}}if(this.isCSVDataFromToday()){let e=this.loadFromCSV();if(e&&e.length>0)return console.log("\uD83D\uDCCA Using existing CSV data from today (GMT-4)"),{data:e,source:"csv_today",timestamp:new Date().toISOString()}}if(this.shouldRunDailyScraper()){console.log("\uD83D\uDD77Ô∏è Running daily scraper for new GMT-4 day...");let e=await this.scrapeEconomicCalendar();if(e&&e.length>0)return this.saveToCSV(e),console.log("‚úÖ Daily scraping completed and saved to CSV"),{data:e,source:"scraped_daily",timestamp:new Date().toISOString()};console.log("‚ö†Ô∏è Daily scraping failed, trying existing CSV data...")}let t=this.loadFromCSV();if(t&&t.length>0)return console.log("\uD83D\uDCC4 Using existing CSV data as fallback"),{data:t,source:"csv_fallback",timestamp:new Date().toISOString()};return console.log("‚ùå No economic calendar data available"),{data:[],source:"none",timestamp:new Date().toISOString()}}catch(t){console.error("‚ùå Error getting economic calendar data:",t);let e=this.loadFromCSV();if(e&&e.length>0)return console.log("\uD83D\uDD27 Using CSV fallback due to error"),{data:e,source:"csv_error_fallback",timestamp:new Date().toISOString()};return{data:[],source:"error",timestamp:new Date().toISOString()}}}async close(){this.browser&&(await this.browser.close(),this.browser=null)}}e.exports=i},6487:()=>{},8335:()=>{}};