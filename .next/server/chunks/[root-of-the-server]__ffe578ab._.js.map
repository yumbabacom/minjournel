{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///E:/trading-journal-app/lib/mongodb.js"],"sourcesContent":["import mongoose from 'mongoose';\r\nimport { MongoClient } from 'mongodb';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb+srv://tmuneebanjum:A5Y1enJBJcDVwPrt@jorn.nx9fd28.mongodb.net/smartsave';\r\nconst DB_NAME = 'trading-journal';\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\n// Mongoose connection (for existing code)\r\nasync function connectDB() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\n// Native MongoDB driver connection (for API routes)\r\nlet clientPromise;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n  // In development mode, use a global variable so that the value\r\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n  if (!global._mongoClientPromise) {\r\n    const client = new MongoClient(MONGODB_URI);\r\n    global._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = global._mongoClientPromise;\r\n} else {\r\n  // In production mode, it's best to not use a global variable.\r\n  const client = new MongoClient(MONGODB_URI);\r\n  clientPromise = client.connect();\r\n}\r\n\r\n// Connect to database function expected by API routes\r\nexport async function connectToDatabase() {\r\n  try {\r\n    const client = await clientPromise;\r\n    console.log('Connected to MongoDB successfully, using database:', DB_NAME);\r\n    const db = client.db(DB_NAME); \r\n    return { client, db };\r\n  } catch (error) {\r\n    console.error('Failed to connect to database:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Export both for compatibility\r\nexport default connectDB;\r\nexport { connectDB }; "],"names":[],"mappings":";;;;;AAAA;AACA;;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C,MAAM,UAAU;AAEhB,uCAAkB;;AAElB;AAEA;;;;CAIC,GACD,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEA,0CAA0C;AAC1C,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;AAEA,oDAAoD;AACpD,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,OAAO,mBAAmB,EAAE;QAC/B,MAAM,SAAS,IAAI,uGAAA,CAAA,cAAW,CAAC;QAC/B,OAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,OAAO,mBAAmB;AAC5C,OAAO;;AAIP;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM;QACrB,QAAQ,GAAG,CAAC,sDAAsD;QAClE,MAAM,KAAK,OAAO,EAAE,CAAC;QACrB,OAAO;YAAE;YAAQ;QAAG;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,MAAM;IACR;AACF;uCAGe","debugId":null}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///E:/trading-journal-app/app/api/trades/route.js"],"sourcesContent":["import { connectToDatabase } from '../../../lib/mongodb';\r\nimport { NextResponse } from 'next/server';\r\nimport { ObjectId } from 'mongodb';\r\n\r\n// GET - Fetch trades for a user, optionally filtered by account\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const userId = searchParams.get('userId');\r\n    const accountId = searchParams.get('accountId');\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ error: 'User ID is required' }, { status: 400 });\r\n    }\r\n\r\n    const { db } = await connectToDatabase();\r\n\r\n    // Build query filter\r\n    const filter = { userId };\r\n    if (accountId) {\r\n      filter.accountId = accountId;\r\n    }\r\n\r\n    const trades = await db.collection('trades').find(filter).sort({ createdAt: -1 }).toArray();\r\n\r\n    return NextResponse.json({ trades });\r\n  } catch (error) {\r\n    console.error('Error fetching trades:', error);\r\n    return NextResponse.json({ error: 'Failed to fetch trades' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST - Create a new trade\r\nexport async function POST(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { \r\n      userId, \r\n      accountId, \r\n      accountSize, \r\n      riskPerTrade, \r\n      tradingPair, \r\n      strategy, \r\n      entryPrice, \r\n      takeProfit, \r\n      stopLoss, \r\n      direction, \r\n      status, \r\n      analysis, \r\n      tags, \r\n      images,\r\n      calculations\r\n    } = body;\r\n\r\n    if (!userId || !accountId || !tradingPair || !entryPrice || !takeProfit || !stopLoss) {\r\n      return NextResponse.json({ error: 'Required fields missing' }, { status: 400 });\r\n    }\r\n\r\n    const { db } = await connectToDatabase();\r\n    \r\n    const tradeData = {\r\n      userId,\r\n      accountId,\r\n      accountSize: parseFloat(accountSize),\r\n      riskPerTrade: parseFloat(riskPerTrade),\r\n      tradingPair,\r\n      strategy: strategy || null,\r\n      entryPrice: parseFloat(entryPrice),\r\n      takeProfit: parseFloat(takeProfit),\r\n      stopLoss: parseFloat(stopLoss),\r\n      direction,\r\n      status: status || 'planning',\r\n      analysis: analysis || '',\r\n      tags: tags || '',\r\n      images: images || [],\r\n      calculations: calculations || {},\r\n      actualEntry: null,\r\n      actualExit: null,\r\n      actualProfit: null,\r\n      exitReason: null,\r\n      notes: '',\r\n      createdAt: new Date(),\r\n      updatedAt: new Date()\r\n    };\r\n\r\n    const result = await db.collection('trades').insertOne(tradeData);\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      tradeId: result.insertedId,\r\n      message: 'Trade created successfully'\r\n    });\r\n  } catch (error) {\r\n    console.error('Error creating trade:', error);\r\n    return NextResponse.json({ error: 'Failed to create trade' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// PUT - Update an existing trade\r\nexport async function PUT(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { tradeId, userId, _id, createdAt, ...updateData } = body;\r\n\r\n    if (!tradeId || !userId) {\r\n      return NextResponse.json({ error: 'Trade ID and User ID are required' }, { status: 400 });\r\n    }\r\n\r\n    // Remove any immutable fields that shouldn't be updated\r\n    const { _id: removeId, userId: removeUserId, createdAt: removeCreatedAt, ...cleanUpdateData } = updateData;\r\n\r\n    const { db } = await connectToDatabase();\r\n    \r\n    const result = await db.collection('trades').updateOne(\r\n      { _id: new ObjectId(tradeId), userId },\r\n      { \r\n        $set: { \r\n          ...cleanUpdateData, \r\n          updatedAt: new Date() \r\n        } \r\n      }\r\n    );\r\n\r\n    if (result.matchedCount === 0) {\r\n      return NextResponse.json({ error: 'Trade not found' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      message: 'Trade updated successfully' \r\n    });\r\n  } catch (error) {\r\n    console.error('Error updating trade:', error);\r\n    return NextResponse.json({ error: 'Failed to update trade' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// DELETE - Delete a trade\r\nexport async function DELETE(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const tradeId = searchParams.get('tradeId') || searchParams.get('id');\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (!tradeId) {\r\n      return NextResponse.json({ error: 'Trade ID is required' }, { status: 400 });\r\n    }\r\n\r\n    const { db } = await connectToDatabase();\r\n\r\n    // Build delete filter\r\n    const deleteFilter = { _id: new ObjectId(tradeId) };\r\n    if (userId) {\r\n      deleteFilter.userId = userId;\r\n    }\r\n\r\n    const result = await db.collection('trades').deleteOne(deleteFilter);\r\n\r\n    if (result.deletedCount === 0) {\r\n      return NextResponse.json({ error: 'Trade not found or access denied' }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      message: 'Trade deleted successfully' \r\n    });\r\n  } catch (error) {\r\n    console.error('Error deleting trade:', error);\r\n    return NextResponse.json({ error: 'Failed to delete trade' }, { status: 500 });\r\n  }\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}